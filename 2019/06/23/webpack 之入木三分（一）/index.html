<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-16.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-32.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"post_wordcount":{"item_text":true,"wordcount":true,"min2read":true}},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="keywords" content="webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack 之入木三分（一）">
<meta property="og:url" content="http://lazyman123.github.io/2019/06/23/webpack 之入木三分（一）/index.html">
<meta property="og:site_name" content="saner·Blog">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://storage-1252595003.cos.ap-guangzhou.myqcloud.com/assets/asset_webpack4.png">
<meta property="og:image" content="https://storage-1252595003.cos.ap-guangzhou.myqcloud.com/assets/asset_webpack_analysis.gif">
<meta property="og:updated_time" content="2019-07-12T04:08:13.820Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Webpack 之入木三分（一）">
<meta name="twitter:image" content="https://storage-1252595003.cos.ap-guangzhou.myqcloud.com/assets/asset_webpack4.png">






  <link rel="canonical" href="http://lazyman123.github.io/2019/06/23/webpack 之入木三分（一）/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Webpack 之入木三分（一） | saner·Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/lazyman123" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">saner·Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">学如逆水行舟，不进则退。</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lazyman123.github.io/2019/06/23/webpack 之入木三分（一）/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="saner">
      <meta itemprop="description" content="相自我改, 命自我造。">
      <meta itemprop="image" content="/images/avatar.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="saner·Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Webpack 之入木三分（一）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-23 10:00:32" itemprop="dateCreated datePublished" datetime="2019-06-23T10:00:32+08:00">2019-06-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 12:08:13" itemprop="dateModified" datetime="2019-07-12T12:08:13+08:00">2019-07-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

          

          

          
          
        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img class="zhaiyao-img" src="https://storage-1252595003.cos.ap-guangzhou.myqcloud.com/assets/asset_webpack4.png"><br><a id="more"></a></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>webpack 是目前最火的项目构建工具，只需要简单的配置，就能够完成对模块的加载和打包。这篇文章意在让我从繁杂的文档中解脱出来。</p>
</blockquote>
<h4 id="不跟你多bb，先看-Webpack-配置"><a href="#不跟你多bb，先看-Webpack-配置" class="headerlink" title="不跟你多bb，先看 Webpack 配置"></a>不跟你多bb，先看 Webpack 配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	mode: <span class="string">"production"</span>, <span class="comment">// "production" | "development" | "none"</span></span><br><span class="line">	devtool: <span class="string">"cheap-module-eval-source-map"</span>, <span class="comment">// development | "cheap-module-source-map" production</span></span><br><span class="line">	entry: <span class="string">"./src/index.js"</span>, <span class="comment">// string | object | array</span></span><br><span class="line">	<span class="comment">// 默认为 ‘./src’</span></span><br><span class="line">	<span class="comment">// 应用程序开始执行</span></span><br><span class="line">	<span class="comment">// webpack 开始打包</span></span><br><span class="line">	output: &#123; </span><br><span class="line">		<span class="comment">// webpack 如何输出结果的相关选项</span></span><br><span class="line">		path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">// string</span></span><br><span class="line">		filename: <span class="string">"[chunkhash.js]"</span>, <span class="comment">// 用于长效缓存 | “[name.js]” 用于多个入口点 | string</span></span><br><span class="line">		publicPath: <span class="string">"/assets/"</span>, <span class="comment">// string 输出解析文件的目录</span></span><br><span class="line">		chunkFilename: <span class="string">"[name].chunk.js"</span>, <span class="comment">// 单独分割第三方库进行长效缓存</span></span><br><span class="line">		...</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="built_in">module</span>: &#123;</span><br><span class="line">		<span class="comment">// 关于模块配置</span></span><br><span class="line">		rules: [ </span><br><span class="line">			<span class="comment">// 配置相关loaders，解析规则</span></span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.(jpe?g|png|gif)(\?.*)?$/</span>,</span><br><span class="line">				use: &#123;</span><br><span class="line">					loader: <span class="string">'url-loader'</span>, </span><br><span class="line">					<span class="comment">// 此 loader 只会去编译 html 和 css 中的 image，若是在 vue 中 用 v-for 遍历 data 图片列表的话就不能使用 base64 编码</span></span><br><span class="line">					options: &#123; <span class="comment">// loader 的可选项</span></span><br><span class="line">						name: <span class="string">'[name]_[hash].[ext]'</span>,</span><br><span class="line">						outputPath: <span class="string">'images/'</span>,</span><br><span class="line">						limit: <span class="number">10240</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.(eot|woff|ttf|svg)$/</span>,</span><br><span class="line">				use: &#123;</span><br><span class="line">					loader: <span class="string">'file-loader'</span> <span class="comment">// 此 loader 与上一个 loader 差别是不能设置图片大小</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.scss$/</span>, <span class="comment">// loader 解析由自下而上，自右向左。</span></span><br><span class="line">				use: [</span><br><span class="line">					<span class="string">'style-loader'</span>, <span class="comment">// 将 JS 字符串生成为 style 节点</span></span><br><span class="line">					&#123;</span><br><span class="line">						loader: <span class="string">'css-loader'</span>, <span class="comment">// 将 CSS 转化成 CommonJS 模块</span></span><br><span class="line">						options: &#123;</span><br><span class="line">							importLoaders: <span class="number">2</span> <span class="comment">// 表示该 loader 后的 执行 loader 数量</span></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="string">'sass-loader'</span>, <span class="comment">// 将 Sass 编译成 CSS</span></span><br><span class="line">					<span class="string">'postcss-loader'</span> <span class="comment">// 给 css 加浏览器前缀适配浏览器 </span></span><br><span class="line">				]</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">		      use: [</span><br><span class="line">		        <span class="string">'style-loader'</span>,</span><br><span class="line">		        <span class="string">'css-loader'</span></span><br><span class="line">		      ]</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">		      test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">		      exclude: <span class="regexp">/node_modules/</span>, <span class="comment">// 必不匹配选项（优先级高于 test 和 include）</span></span><br><span class="line">		      loader: <span class="string">'babel-loader'</span> <span class="comment">// 获取兼容浏览器的 JavaScript 代码</span></span><br><span class="line">		   &#125;</span><br><span class="line">			...</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	performance: &#123; <span class="comment">// object</span></span><br><span class="line">		hints: <span class="string">'warninig'</span>  <span class="comment">// 将展示一条警告，通知你这是体积大的资源。推荐开发环境</span></span><br><span class="line">	&#125;,</span><br><span class="line">	optimization: &#123; <span class="comment">// 优化</span></span><br><span class="line">		splitChunks: &#123; <span class="comment">// 分块策略</span></span><br><span class="line">			chunks: <span class="string">'all'</span>, <span class="comment">// 允许同步和异步 | initial | async (默认) | all (推荐)</span></span><br><span class="line">			minSize: <span class="number">30000</span>, <span class="comment">// 形成一个新代码块最小的体积</span></span><br><span class="line">			maxSize: <span class="number">0</span>, <span class="comment">// 超过此大小一般来说会再此被分割成文件</span></span><br><span class="line">			minChunks: <span class="number">1</span>, <span class="comment">// 在分割之前，这个代码块最小应该被引用的次数，默认策略是不需要多次引用也可以被分割</span></span><br><span class="line">			maxAsyncRequests: <span class="number">5</span>, <span class="comment">// 按需加载时候最大的并行请求数</span></span><br><span class="line">			maxInitialRequests: <span class="number">3</span>, <span class="comment">// 一个入口最大的并行请求数</span></span><br><span class="line">			automaticNameDelimiter: <span class="string">'~'</span>, <span class="comment">// 打包分隔符</span></span><br><span class="line">			name: <span class="literal">true</span>, <span class="comment">// 打包后的名称，此选项可接收 function</span></span><br><span class="line">			cacheGroups: &#123; <span class="comment">// 缓存组</span></span><br><span class="line">				vendors: &#123; <span class="comment">// key 为entry中定义的 入口名称</span></span><br><span class="line">					test: <span class="regexp">/[\\/]node_modules[\\/]/</span>, <span class="comment">// 用于控制哪些模块被这个缓存组匹配到。原封不动传递出去的话，它默认会选择所有的模块。可以传递的值类型：RegExp、String和Function</span></span><br><span class="line">					priority: <span class="number">-10</span>, <span class="comment">// 缓存组打包的先后优先级</span></span><br><span class="line">					<span class="comment">// filename: 'vendors' 要缓存的 分隔出来的 chunk 名称</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="keyword">default</span>: &#123;  <span class="comment">// 这里是表示不在 node_modules 中的分割块</span></span><br><span class="line">					minChunks: <span class="number">2</span>,</span><br><span class="line">					priority: <span class="number">-20</span>,</span><br><span class="line">					reuseExistingChunk: <span class="literal">true</span> <span class="comment">// 可设置是否重用该chunk</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	plugins: [</span><br><span class="line">		<span class="keyword">new</span> HtmlWebpackPlugin(&#123;  </span><br><span class="line">		<span class="comment">// 生成一个 HTML5 文件， 其中包含使用 script 标签的 body 中的 所有 webpack 包。如果有多个 webpack 入口点，他们都会在生成的 HTML 文件中的 script 标签内。</span></span><br><span class="line">			title: <span class="string">'学习 webpack'</span>,</span><br><span class="line">			template: <span class="string">'src/index.html'</span>,</span><br><span class="line">			minify: &#123;</span><br><span class="line">				collapseWhitespace: <span class="literal">true</span>  <span class="comment">// 压缩，去掉所有空格</span></span><br><span class="line">			&#125;,</span><br><span class="line">			hash: <span class="literal">true</span>  <span class="comment">// 添加 hash</span></span><br><span class="line">		&#125;),</span><br><span class="line">		<span class="keyword">new</span> CleanWebpackPlugin()  <span class="comment">// 删除文件，保留新文件</span></span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在实际开发当中，是要区分开发环境和生产环境。大致目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ build</span><br><span class="line">+ config</span><br><span class="line">+ src</span><br></pre></td></tr></table></figure>
<p>在 build 目录下有三个 webpack 配置，分别是：</p>
<ul>
<li>webpack.base.conf.js</li>
<li>webpack.dev.conf.js</li>
<li>webpack.prod.conf.js</li>
</ul>
<p>这分别对应开发、生产和测试环境的配置。其中 webpack.base.conf.js 是一些公共的配置项。我们使用 webpack-merge 把这些公共配置项和环境特定的配置项 merge 起来，成为一个完整的配置项。比如 webpack.dev.conf.js 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">	mode: <span class="string">"development"</span>,</span><br><span class="line">	devtool: <span class="string">"cheap-module-eval-source-map"</span>,</span><br><span class="line">	devServer: &#123;</span><br><span class="line">		contentBase: <span class="string">'./dist'</span>, <span class="comment">// 告诉服务器从哪里提供内容。只有在你想要提供静态文件时才需要。</span></span><br><span class="line">		open: <span class="literal">true</span>, <span class="comment">// 自启动默认浏览器</span></span><br><span class="line">		hot: <span class="literal">true</span>, <span class="comment">//启用 webpack 的热模块更换功能</span></span><br><span class="line">		hotOnly: <span class="literal">true</span>, <span class="comment">// 在生成失败的情况下，启用热模块替换（请参阅devServer.hot），而不刷新页面作为回退。</span></span><br><span class="line">		host: <span class="string">"0.0.0.0"</span> <span class="comment">// 指定要使用的主机，默认 localhost。这里的作用是希望你的服务器允许外部访问</span></span><br><span class="line">		port: <span class="number">9000</span>,</span><br><span class="line">		compress: <span class="literal">true</span>, <span class="comment">// 为服务的所有内容启用 gzip 压缩</span></span><br><span class="line">		https: <span class="literal">true</span>, <span class="comment">// 默认情况下，dev-server将通过HTTP提供服务</span></span><br><span class="line">		<span class="comment">// https: &#123;</span></span><br><span class="line">		<span class="comment">//	key: fs.readFileSync("/path/to/server.key"),</span></span><br><span class="line">		<span class="comment">// cert: fs.readFileSync("/path/to/server.crt"),</span></span><br><span class="line">		<span class="comment">// ca: fs.readFileSync("/path/to/ca.pem"),</span></span><br><span class="line">		<span class="comment">// &#125; // 设置签名证书</span></span><br><span class="line">		</span><br><span class="line">		allowedHosts: [ <span class="comment">// array | 该选项允许您将允许访问开发服务器的服务列入白名单</span></span><br><span class="line">			<span class="string">'host.com'</span>,</span><br><span class="line">		   <span class="string">'subdomain.host.com'</span>,</span><br><span class="line">		   <span class="string">'subdomain2.host.com'</span>,</span><br><span class="line">		   <span class="string">'host2.com'</span></span><br><span class="line">		],</span><br><span class="line">		proxy: &#123;</span><br><span class="line">			<span class="comment">// 当你有一个单独的API后端开发服务器，并且你想在同一个域上发送 API 请求时，代理一些 URL 会很有用。</span></span><br><span class="line">			<span class="string">"/api"</span>: <span class="string">"http://localhost:3000"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	optimization: &#123;</span><br><span class="line">		usedExports: <span class="literal">true</span> <span class="comment">// 开发环境下配置 tree shaking</span></span><br><span class="line">	&#125;,</span><br><span class="line">	plugins: [</span><br><span class="line">		<span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, devConfig);</span><br></pre></td></tr></table></figure>
<p>从上面 webpack 配置来看，再配置 .babelrc 文件，使其能够使用新的 ES 语法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>, &#123;</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"chrome"</span>: <span class="string">"67"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"useBuiltIns"</span>: <span class="string">"usage"</span> <span class="comment">// 在此配置后，文件中无需手动添加 @babel/polyfile</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"@babel/plugin-syntax-dynamic-import"</span>]  <span class="comment">// 识别魔法注释</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再加一个 postcss.config.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些基本满足日常开发需求，若是用 vue 或者 react 开发，再添加相关 loader 就好。</p>
<h3 id="Webpack-高级概念"><a href="#Webpack-高级概念" class="headerlink" title="Webpack 高级概念"></a>Webpack 高级概念</h3><h4 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h4><blockquote>
<p>tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块语法的 静态结构 特性，例如 import 和 export。</p>
</blockquote>
<p>不过需要注意的是， tree shaking 能移除无用代码的同时，也有一定的副作用（错误识别无用代码）。比如你可能会遇到 UI 组件库没有样式的问题，这个问题原因在于 tree shaking 不仅对 JS 生效，也对 CSS 生效 。我们通常在导入 CSS 时使用 import ‘xxx.min.css’ ， ES6 的静态导入 + 生产环境满足了 tree shaking 的生效条件，并且 Webpack 无法判断 CSS 有效，所以它被当做了 dead-code 然后被删除。为了解决这个问题，你可以在 package.json 中添加一个 sideEffects 选项，告知 Webpack 那些文件是可以直接引入而不用 tree shaking 检查的，使用如下：</p>
<p><strong>package.json</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"sideEffects"</span>: [</span><br><span class="line">    <span class="string">"*.css"</span>,</span><br><span class="line">    <span class="string">"*.styl(us)?"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：创建一个 <strong>math.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(a + b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> minus = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(a + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <strong>index.js</strong> 中引用它</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tree Shaking</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">'./math.js'</span>;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>然后利用之前的 webpack 配置打包，因为其中 optimization 配置了usedExports。看打包后的 <strong>main.js</strong> 中是否有多余的 minus 方法。</p>
<h4 id="Code-Splitting"><a href="#Code-Splitting" class="headerlink" title="Code Splitting"></a>Code Splitting</h4><p>它一般做什么：</p>
<ul>
<li>为 vendor 单独打包 （vendor 指第三方的库或者公共的基础组件，因为 Vendor 的变化比较少，单独打包利于缓存）</li>
<li>为 Manifest （Webpack 的 Runtime 代码）单独打包</li>
<li>为不同入口的公共业务代码打包（同理，也是为了缓存和加载速度）</li>
<li>为异步加载的代码打一个公共的包</li>
</ul>
<p>在 webpack3 及以前我们都利用 CommonsChunkPlugin 将一些公共代码分割成一个 chunk，实现单独加载。在 webpack4 中 CommonsChunkPlugin 被废弃，使用 SplitChunksPlugin，其配置如上 webpack 所示。</p>
<p>有一点要知道其实 Code Splitting 与 webpack 是无关的，因为不需要 webpack 依然可以做代码分割。之所以用到它是因为更加方便。</p>
<p>示例：<strong>index.js</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我现在想引入一个 lodash 工具库，第一种方式是直接 import 它（静态引入）。</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>; <span class="number">1</span>mb</span><br><span class="line"></span><br><span class="line">... 业务逻辑 <span class="number">1</span>mb</span><br><span class="line"><span class="built_in">console</span>.log(_.join([<span class="string">'a'</span>,<span class="string">'b'</span>], <span class="string">'*'</span>))</span><br><span class="line"><span class="comment">// 这种方式，首次访问页面时，加载 main.js 假设打包后是 2mb，当业务逻辑发生改变时，又要加载 2mb 的内容</span></span><br><span class="line"></span><br><span class="line">第二种方式</span><br><span class="line">那我不用 splitChunksPlugin 配置呢，那就先创建一个新的文件 lodash.js，引入 lodash ，再付给全局变量 <span class="built_in">window</span>，再到 webpack 配置中配置一下入口文件加一个入口。如此 main.js 就被拆成两个文件 lodash.js、main.js,当业务逻辑发生改变时，只需加载 main.js 即可 (<span class="number">1</span>mb)</span><br><span class="line"></span><br><span class="line">第三种方式</span><br><span class="line">在 webpack 中的 optimization 加上 splitChunksPlugin。</span><br><span class="line">optimization: &#123;</span><br><span class="line">	splitChunks: &#123;</span><br><span class="line">		chunks: <span class="string">'all'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">这里打包后 dist 目录就会增加一个 vendors~main.js 文件。</span><br><span class="line"></span><br><span class="line">第四种方式</span><br><span class="line">当然除了设置 webpack 之外，还有一种是异步引入 lodash，这种方式打包后也会生成一个单独的文件类似 <span class="number">0.</span>js</span><br><span class="line">例如： index.js 中是这样</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">import</span>(<span class="string">'lodash'</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: _ &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">		element.innerHTML = _.join([<span class="string">'hello'</span>, <span class="string">'world'</span>], <span class="string">','</span>);</span><br><span class="line">		<span class="keyword">return</span> element;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getComponent().then(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">document</span>.body.appendChild(element);</span><br><span class="line">&#125;)</span><br><span class="line">当然也可以用 <span class="keyword">async</span> / <span class="keyword">await</span> 代替 promise。</span><br></pre></td></tr></table></figure></p>
<h4 id="Lazy-Loading-懒加载"><a href="#Lazy-Loading-懒加载" class="headerlink" title="Lazy Loading 懒加载"></a>Lazy Loading 懒加载</h4><p>按需加载又名<strong>懒加载</strong>，是指当需要依赖的页面被打开采取加载这个依赖，这样就减少了主页的负担，提升首屏渲染速度。而要做到按需加载，你只需在导入依赖的时候用 import 或 require.ensure 这两种动态加载方式。</p>
<p>在这一点上可以根据上面的代码稍微改动下如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">default</span>: _ &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName:"lodash" */</span> <span class="string">"lodash"</span>); </span><br><span class="line">  <span class="keyword">const</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  element.innerHTML = _.join([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], <span class="string">'.'</span>);</span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">  getComponent().then(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(element);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">如此刚开始进入页面的时候或页面刷新的时候并不需要加载 lodash，这样就提高了页面的访问速度。在 vue 和 react 中的路由设置也是 <span class="keyword">import</span> 引入页面组件的，只有当访问到此间页面才会加载其中的组件和资源。这即是懒加载的功能。</span><br></pre></td></tr></table></figure>
<h4 id="打包分析，Preloading，Prefetching"><a href="#打包分析，Preloading，Prefetching" class="headerlink" title="打包分析，Preloading，Prefetching"></a>打包分析，Preloading，Prefetching</h4><h5 id="打包分析"><a href="#打包分析" class="headerlink" title="打包分析"></a>打包分析</h5><p>推荐使用 webpack-bundle-analyzer ，它会启动一个服务，在浏览器中很清楚地展现生成物和源文件的映射关系和层级，也可以在 package.json 中加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --profile --json &gt; stats.json // 意思是把配置信息存进 stats.json 中</span><br></pre></td></tr></table></figure>
<p><strong>安装</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-bundle-analyzer</span><br></pre></td></tr></table></figure>
<p>配置：在 webpack.prod.conf.js 中增加以下配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin;</span><br><span class="line"> <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> BundleAnalyzerPlugin()</span><br><span class="line">  ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>在 项目的 package.json 文件中注入如下命令，以方便运行她(npm run analyz)，默认会打开<a href="http://127.0.0.1:8888作为展示。" target="_blank" rel="noopener">http://127.0.0.1:8888作为展示。</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“analyz”: “NODE_ENV=production npm_config_report=<span class="literal">true</span> npm run build”</span><br></pre></td></tr></table></figure>
<p>运行 npm run build，如图所示</p>
<p><img style="display:inline-block" src="https://storage-1252595003.cos.ap-guangzhou.myqcloud.com/assets/asset_webpack_analysis.gif"></p>
<p><strong>Prefetch</strong><br>在声明 import 时，使用下面这些内置指令，可以让 webpack 输出 “resource hint(资源提示)”，来告知浏览器</p>
<ul>
<li>prefetch(预取)：将来某些导航下可能需要的资源</li>
<li>preload(预加载)：当前导航下可能需要资源</li>
</ul>
<p>下面这个 prefetch 的简单示例中，有一个 HomePage 组件，其内部渲染一个 LoginButton 组件，然后在点击后按需加载 LoginModal 组件。</p>
<p><strong>LoginButton.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true */</span> <span class="string">'LoginModal'</span>);</span><br></pre></td></tr></table></figure>
<p>这会生成 <link rel="prefetch" href="login-modal-chunk.js"> 并追加到页面头部，指示着浏览器在闲置时间预取 login-modal-chunk.js 文件。</p>
<p>与 prefetch 指令相比，preload 指令有许多不同之处：</p>
<pre><code>- preload chunk 会在父 chunk 加载时，以并行方式开始加载。prefetch chunk 会在父 chunk 加载结束后开始加载。
- preload chunk 具有中等优先级，并立即下载。prefetch chunk 在浏览器闲置时下载。
- preload chunk 会在父 chunk 中立即请求，用于当下时刻。prefetch chunk 会用于未来的某个时刻。
- 浏览器支持程度不同。
</code></pre><h4 id="CSS-文件的代码分割"><a href="#CSS-文件的代码分割" class="headerlink" title="CSS 文件的代码分割"></a>CSS 文件的代码分割</h4><p>首先安装 MiniCssExtractPlugin</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin  <span class="comment">// 打包 css</span></span><br><span class="line">npm install --save-dev optimize-css-assets-webpack-plugin <span class="comment">// 压缩 css 压缩是生产环境下的优化，开发环境去设置它反而会影响到热加载性能、适得其反</span></span><br></pre></td></tr></table></figure>
<p><strong>webpack.prod.config.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      <span class="comment">// Options similar to the same options in webpackOptions.output</span></span><br><span class="line">      <span class="comment">// both options are optional</span></span><br><span class="line">      filename: <span class="string">"[name].css"</span>,</span><br><span class="line">      chunkFilename: <span class="string">"[id].css"</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  optimization: &#123;</span><br><span class="line">  		minimizer: [<span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;&#125;)]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: MiniCssExtractPlugin.loader, <span class="comment">// 这里不能用 style-loader,同理 scss 等线上环境的打包都用此种方式。</span></span><br><span class="line">            options: &#123;</span><br><span class="line">              <span class="comment">// you can specify a publicPath here</span></span><br><span class="line">              <span class="comment">// by default it use publicPath in webpackOptions.output</span></span><br><span class="line">              publicPath: <span class="string">'../'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"css-loader"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Webpack-与浏览器缓存（Caching）"><a href="#Webpack-与浏览器缓存（Caching）" class="headerlink" title="Webpack 与浏览器缓存（Caching）"></a>Webpack 与浏览器缓存（Caching）</h4><p>当我们每次打包的时候，这里有个问题。在改变源代码的情况下打包后，用户浏览器上有我们之前代码包的缓存，这里我们需要配置一下来更新下代码。</p>
<p><strong>webpack.pord.conf.js</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	output: &#123;</span><br><span class="line">		filename: <span class="string">'[name].[contenthash].js'</span>,</span><br><span class="line">		chunkFilename: <span class="string">'[name].[contenthash].js'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>显而易见，这是根据代码内容变化所产生一个 hash 值，代码不变，文件包名字也不改变，这样就解决了上面的问题。</p>
<p>当然还有可能会遇到一个问题，当我们没有改变这源代码，但是打包后的 hash 值依然改变了，这即是 webpack 的版本太低了，在新版本中会默认有个这样的配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	optimization: &#123;</span><br><span class="line">		runtimeChunk: &#123;</span><br><span class="line">			name: <span class="string">'runtime'</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先为什么 hash 值依然改变了，那是因为在我们打包后的 main.js 和 chunk 之间有着关联关系的存在，即 manifest，老版本在打包后 manifest 可能会发生改变。所以造成 hash 跟着变了的结果。上面配置解决的即是把关连关系单独提出一个文件出来为 runtime.[hash].js 这样每次打包的时候主文件和库文件的 hash 问题就解决了。</p>
<h4 id="Shimming-的作用"><a href="#Shimming-的作用" class="headerlink" title="Shimming 的作用"></a>Shimming 的作用</h4><p>它的作用意在解决 webpack 打包过程当中的兼容问题，类似 @babel/polyfill 解决的是兼容低版本浏览器中没有 promise 等全局变量的问题。这就是所谓的<strong>垫片</strong>。</p>
<p>先看个🌰:</p>
<p><strong>index.js</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ui &#125; <span class="keyword">from</span> <span class="string">'./jquery.ui'</span></span><br><span class="line"></span><br><span class="line">ui();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dom = $(<span class="string">'div'</span>);</span><br><span class="line">dom.html(_.join([<span class="string">'dell'</span>, <span class="string">'lee'</span>], <span class="string">'---'</span>));</span><br><span class="line">$(<span class="string">'body'</span>).append(dom);</span><br></pre></td></tr></table></figure></p>
<p><strong>jquery.ui.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ui</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">'body'</span>).css(<span class="string">'background'</span>, <span class="string">'red'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在此 index.js 中要在外部引入 jquery.ui.js 这个库文件，但是这里会有个小问题，jquery.ui.js 在打包后会报一个错 $ is undefined. 显而易见，在ES module 中变量是不能跨文件的，也即是安全变量。这种形式解决了模块与模块之间的耦合。</p>
<p>当然你不可能修改库文件代码，或者去 node_modules 里面去修改代码，在里面引入一个 $ 变量。所以这时候就要用到 shimming。如下所示：</p>
<p><strong>webpack.base.conf.js</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	plugins: [</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">			$: <span class="string">'jquery'</span>, <span class="comment">// 作用是在发现模块中有 $ 这个字符串的时候，就表示引入了 jquery</span></span><br><span class="line">			_join: [<span class="string">'lodash'</span>, <span class="string">'join'</span>]  <span class="comment">// shimming 的细粒化，即只用lodash中的 join 方法</span></span><br><span class="line">		&#125;)</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>shimming</strong> 就是帮助修改或者解决 webpack 一些不能解决的事情。又比如，我想在模块中使用 this，同时要使它指向 window。我们知道 模块中的 this 都是指向模块自身。为了得到你想要的 this。可以这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="built_in">module</span>: &#123;</span><br><span class="line">		rules: [&#123;</span><br><span class="line">			test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">			exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">			use: [</span><br><span class="line">				&#123;</span><br><span class="line">					loader: <span class="string">'babel-loader'</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					loader: <span class="string">'imports-loader? this=&gt;window'</span></span><br><span class="line">				&#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/webpack/" rel="tag"># webpack</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/21/mac下安装mysql/" rel="next" title="在云服务器上（CentOS）上安装 Mysql">
                <i class="fa fa-chevron-left"></i> 在云服务器上（CentOS）上安装 Mysql
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/12/05/JS中的类型判断（二）/" rel="prev" title="JS中的类型判断（二）">
                JS中的类型判断（二） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.JPG" alt="saner">
            
              <p class="site-author-name" itemprop="name">saner</p>
              <p class="site-description motion-element" itemprop="description">相自我改, 命自我造。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/lazyman123" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#不跟你多bb，先看-Webpack-配置"><span class="nav-number">1.1.</span> <span class="nav-text">不跟你多bb，先看 Webpack 配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Webpack-高级概念"><span class="nav-number">2.</span> <span class="nav-text">Webpack 高级概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Tree-Shaking"><span class="nav-number">2.1.</span> <span class="nav-text">Tree Shaking</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code-Splitting"><span class="nav-number">2.2.</span> <span class="nav-text">Code Splitting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lazy-Loading-懒加载"><span class="nav-number">2.3.</span> <span class="nav-text">Lazy Loading 懒加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#打包分析，Preloading，Prefetching"><span class="nav-number">2.4.</span> <span class="nav-text">打包分析，Preloading，Prefetching</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#打包分析"><span class="nav-number">2.4.1.</span> <span class="nav-text">打包分析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS-文件的代码分割"><span class="nav-number">2.5.</span> <span class="nav-text">CSS 文件的代码分割</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Webpack-与浏览器缓存（Caching）"><span class="nav-number">2.6.</span> <span class="nav-text">Webpack 与浏览器缓存（Caching）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Shimming-的作用"><span class="nav-number">2.7.</span> <span class="nav-text">Shimming 的作用</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-star fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">saner</span>

  

  
</div>




  <div class="powered-by">
  <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
    本站访客数:<span id="busuanzi_value_site_uv"></span>
  </span>
  </div>
  <!-- <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.8.0</div>
-->



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.3.0</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共33.4k字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  


  <div class="bg_content">
       <canvas id="canvas"></canvas>
  </div>
  <script>
 'use strict';

    var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

    function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

    function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

    var Circle = function () {
       function Circle(x, y) {
            _classCallCheck(this, Circle);

            this.x = x;
            this.y = y;
            this.r = Math.random() * 10;
            this._mx = Math.random();
            this._my = Math.random();
        }

       _createClass(Circle, [{
            key: 'drawCircle',
            value: function drawCircle(ctx) {
                ctx.beginPath();
                //arc() 方法使用一个中心点和半径，为一个画布的当前子路径添加一条弧。
                ctx.arc(this.x, this.y, this.r, 0, 360);
                ctx.closePath();
                ctx.fillStyle = 'rgba(204, 204, 204, 0.3)';
                ctx.fill();
            }
        }, {
            key: 'drawLine',
            value: function drawLine(ctx, _circle) {
                var dx = this.x - _circle.x;
                var dy = this.y - _circle.y;
                var d = Math.sqrt(dx * dx + dy * dy);
                if (d < 150) {
                    ctx.beginPath();

                    ctx.moveTo(this.x, this.y); //起始点
                    ctx.lineTo(_circle.x, _circle.y); //终点
                    ctx.closePath();
                    ctx.strokeStyle = 'rgba(204, 204, 204, 0.3)';
                    ctx.stroke();
                }
            }


        }, {
            key: 'move',
            value: function move(w, h) {
                this._mx = this.x < w && this.x > 0 ? this._mx : -this._mx;
                this._my = this.y < h && this.y > 0 ? this._my : -this._my;
                this.x += this._mx / 2;
                this.y += this._my / 2;
            }
        }]);

        return Circle;
    }();



    var currentCirle = function (_Circle) {
        _inherits(currentCirle, _Circle);

        function currentCirle(x, y) {
            _classCallCheck(this, currentCirle);

            return _possibleConstructorReturn(this, (currentCirle.__proto__ || Object.getPrototypeOf(currentCirle)).call(this, x, y));
        }

        _createClass(currentCirle, [{
            key: 'drawCircle',
            value: function drawCircle(ctx) {
                ctx.beginPath();

                //this.r = (this.r < 14 && this.r > 1) ? this.r + (Math.random() * 2 - 1) : 2;
                this.r = 8;
                ctx.arc(this.x, this.y, this.r, 0, 360);
                ctx.closePath();
                //ctx.fillStyle = 'rgba(0,0,0,' + (parseInt(Math.random() * 100) / 100) + ')'
                ctx.fillStyle = 'rgba(255, 77, 54, 0.6)';
                ctx.fill();
            }
        }]);

        return currentCirle;
    }(Circle);


    window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var w = canvas.width = canvas.offsetWidth;
    var h = canvas.height = canvas.offsetHeight;
    var circles = [];
    var current_circle = new currentCirle(0, 0);

    var draw = function draw() {
        ctx.clearRect(0, 0, w, h);
        for (var i = 0; i < circles.length; i++) {
            circles[i].move(w, h);
            circles[i].drawCircle(ctx);
            for (j = i + 1; j < circles.length; j++) {
                circles[i].drawLine(ctx, circles[j]);
            }
        }
        if (current_circle.x) {
            current_circle.drawCircle(ctx);
            for (var k = 1; k < circles.length; k++) {
                current_circle.drawLine(ctx, circles[k]);
            }
        }
        requestAnimationFrame(draw);
    };

    var init = function init(num) {
        for (var i = 0; i < num; i++) {
            circles.push(new Circle(Math.random() * w, Math.random() * h));
        }
        draw();
    };
    window.addEventListener('load', init(60));
    window.onmousemove = function (e) {
        e = e || window.event;
        current_circle.x = e.clientX;
        current_circle.y = e.clientY;
    };
    window.onmouseout = function () {
        current_circle.x = null;
        current_circle.y = null;
    };
    
  </script>

</body>
</html>
